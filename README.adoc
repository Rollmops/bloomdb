= BloomDB CLI - Database Migration Tool

image:https://github.com/rollmops/bloomdb/workflows/Tests/badge.svg["Build Status", link="https://github.com/rollmops/bloomdb/actions"]
image:https://codecov.io/gh/rollmops/bloomdb/branch/main/graph/badge.svg["Coverage", link="https://codecov.io/gh/rollmops/bloomdb"]

BloomDB is a powerful database migration tool that supports multiple database backends including PostgreSQL, SQLite, and Oracle. It provides versioned and repeatable migrations with proper tracking and error handling.

== Quick Start

=== Installation

[source,bash]
----
# Build from source
git clone https://github.com/rollmops/bloomdb.git
cd bloomdb
go build

# Or download pre-built binary (when available)
----

=== Basic Usage

[source,bash]
----
# Set database connection
export BLOOMDB_CONNECT_STRING="postgres://user:pass@localhost/mydb"

# Initialize existing database
./bloomdb baseline

# Apply migrations
./bloomdb migrate --path ./migrations

# Check status
./bloomdb info
----

=== Migration Files

Create a `migrations/` directory with SQL files:

[source]
----
migrations/
├── V1__Create_users_table.sql
├── V2__Create_posts_table.sql
└── R__Create_updated_at_triggers.sql
----

* **Versioned migrations**: `V{version}__{description}.sql` (run once)
* **Repeatable migrations**: `R__{description}.sql` (re-run when changed)

=== Connection Strings

* **PostgreSQL**: `postgres://user:password@localhost:5432/database?sslmode=disable`
* **SQLite**: `sqlite:/path/to/database.db`
* **Oracle**: `oracle://user:password@localhost:1521/service_name`

== Documentation

For comprehensive documentation, see the link:docs/[docs directory](docs/index.adoc):

* link:docs/getting-started.adoc[Getting Started Guide]
* link:docs/migration-files.adoc[Migration Files Reference]
* link:docs/commands.adoc[Commands Reference]
* link:docs/configuration.adoc[Configuration Guide]
* link:docs/advanced-usage.adoc[Advanced Usage]
* link:docs/troubleshooting.adoc[Troubleshooting]

== Features

* **Multi-database support**: PostgreSQL, SQLite, Oracle
* **Versioned migrations**: Ordered migration execution with version tracking
* **Repeatable migrations**: Re-applyable migrations for triggers, views, etc.
* **Checksum validation**: Flyway-compatible CRC32 checksums detect modified migrations
* **Error handling**: Failed migrations stop execution and aren't recorded
* **Baseline support**: Initialize existing databases with migration tracking
* **Database-specific filtering**: Support for database-specific migration variants
* **Subdirectory migrations**: Multi-tenant and multi-schema support with isolated migration histories

== Multi-Tenant & Multi-Schema Support

BloomDB supports organizing migrations into subdirectories, perfect for multi-tenant SaaS applications or managing multiple database schemas independently.

=== How It Works

When the migration path contains subdirectories without any migrations at the root level, BloomDB automatically processes each subdirectory as an independent migration context with its own version table.

[source]
----
migrations/
├── tenant-a/
│   ├── V1__create_users.sql
│   └── V2__add_email.sql
└── tenant-b/
    ├── V1__create_users.sql
    └── V2__add_name.sql
----

=== Version Table Naming

Each subdirectory gets its own version table:

* Pattern: `BLOOMDB_<DIRNAME>`
* Directory name is uppercased
* Hyphens replaced with underscores

Examples:

* `tenant-a/` → version table `BLOOMDB_TENANT_A`
* `tenant_b/` → version table `BLOOMDB_TENANT_B`
* `schema-prod/` → version table `BLOOMDB_SCHEMA_PROD`

=== Usage

All commands work with subdirectories:

[source,bash]
----
# Initialize all subdirectories
./bloomdb baseline --path ./migrations

# Migrate all subdirectories
./bloomdb migrate --path ./migrations

# Check status for all subdirectories
./bloomdb info --path ./migrations

# Repair all subdirectories
./bloomdb repair --path ./migrations
----

=== Important Notes

* **Root migrations take precedence**: If migrations exist at the root level, subdirectories are ignored
* **Depth 1 only**: BloomDB only processes immediate subdirectories, not nested ones
* **Independent histories**: Each subdirectory maintains its own migration history, baseline, and checksums
* **Empty subdirectories ignored**: Subdirectories without migration files are skipped

=== Use Cases

* **Multi-tenant SaaS**: Separate migration history per tenant
* **Multi-schema databases**: Independent schema evolution
* **Environment-specific migrations**: Different migrations for dev/staging/prod
* **Microservices**: Per-service database migrations in a monorepo

== License

BloomDB is licensed under the MIT License. See the link:LICENSE[LICENSE] file for details.

This means you are free to:

* **Use** - Use BloomDB for any purpose, including commercial applications
* **Modify** - Change the source code to suit your needs
* **Distribute** - Share BloomDB with others
* **Sublicense** - Include BloomDB in larger projects
* **Sell** - Use BloomDB in commercial products

Under the simple condition that you include the copyright notice and license text in all copies or substantial portions of the software.